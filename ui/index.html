<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spec‑Kit • Single‑file UI</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #151823;
      --panel-2: #111420;
      --muted: #a2a9b5;
      --text: #e7ebf3;
      --brand: #7c8cff;
      --brand-2: #9b7cff;
      --success: #22c55e;
      --danger: #ef4444;
      --warn: #f59e0b;
      --border: #23273a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
      color: var(--text); background: radial-gradient(1000px 600px at 90% -20%, rgba(124,140,255,.08), transparent),
               radial-gradient(800px 500px at 10% 110%, rgba(155,124,255,.08), transparent), var(--bg);
      user-select: none;
    }
    /* Layout */
    .app { display: grid; grid-template-columns: 260px 1fr 340px; grid-template-rows: 56px 1fr; height: 100dvh; }
    header { grid-column: 1 / -1; display: flex; align-items: center; gap: 12px; padding: 10px 16px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)); backdrop-filter: blur(6px); position: sticky; top: 0; z-index: 5; }
    .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing:.3px }
    .logo svg { width: 22px; height: 22px; }
    .search { margin-left: auto; position: relative; }
    .search input { height: 34px; width: 320px; border-radius: 10px; border: 1px solid var(--border); background: var(--panel-2); color: var(--text); padding: 0 34px 0 10px; outline: none; }
    .kbd { border:1px solid var(--border); padding:2px 6px; border-radius:6px; color:var(--muted); background: #0c0f16; margin-left: 8px; }
    .btn { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: white; padding: 8px 12px; border: 0; border-radius: 10px; cursor: pointer; box-shadow: var(--shadow); }
    .ghost { background: transparent; border: 1px solid var(--border); color: var(--text); box-shadow: none; }

    aside { border-right: 1px solid var(--border); background: linear-gradient(180deg, rgba(124,140,255,.03), rgba(0,0,0,0)); padding: 14px; }
    .right { border-left: 1px solid var(--border); background: linear-gradient(180deg, rgba(155,124,255,.03), rgba(0,0,0,0)); padding: 14px; }

    .section-title { display:flex; align-items:center; justify-content:space-between; color: var(--muted); font-size:12px; text-transform: uppercase; letter-spacing: .12em; margin: 6px 2px 10px; }
    .list { display: grid; gap: 6px; }
    .spec-item { border:1px solid var(--border); padding: 10px; border-radius: 12px; background: rgba(255,255,255,.02); cursor: pointer; display: grid; gap: 6px; }
    .spec-item:hover { background: rgba(255,255,255,.04); }
    .tag { font-size: 11px; padding: 2px 8px; border-radius: 999px; border:1px solid var(--border); color: var(--muted); }

    main { padding: 14px; overflow: auto; }
    .tabs { display: flex; gap: 8px; margin-bottom: 10px; }
    .tab { padding: 8px 12px; border:1px solid var(--border); border-bottom: none; border-top-left-radius: 10px; border-top-right-radius: 10px; background: #0e121c; cursor:pointer; color:var(--muted) }
    .tab.active { color: var(--text); background: linear-gradient(180deg, #111627, #0b0f19); }
    .editor { border:1px solid var(--border); border-radius: 12px; background: var(--panel); padding: 14px; min-height: 360px; box-shadow: var(--shadow); }
    .toolbar { display:flex; align-items:center; gap:8px; margin-bottom: 12px; }
    .pill { padding:6px 10px; border:1px solid var(--border); border-radius:999px; color: var(--muted); background: #0d111b; }

    .split { display: grid; grid-template-columns: 1.1fr .9fr; gap: 14px; }
    .card { border:1px solid var(--border); border-radius: 14px; background: var(--panel); padding: 12px; box-shadow: var(--shadow); }
    .card h4 { margin: 0 0 8px 0; font-size: 14px; color: #cfd6e6; }
    .meta { display:flex; gap:8px; flex-wrap: wrap; }

    .status { display:flex; gap:6px; align-items:center; }
    .dot { width:8px; height:8px; border-radius:999px; background: var(--warn); display:inline-block; }

    /* Command Palette */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.5); display: none; align-items: start; justify-content: center; padding-top: 10vh; z-index: 50; }
    .palette { width: 720px; border-radius: 14px; background: #0c0f16; border: 1px solid var(--border); box-shadow: var(--shadow); overflow: hidden; }
    .palette input { width: 100%; padding: 12px 14px; background: #0e1320; border: 0; color: var(--text); outline: none; border-bottom: 1px solid var(--border); }
    .palette .items { max-height: 360px; overflow: auto; }
    .palette .item { padding: 12px 14px; border-bottom: 1px solid var(--border); cursor: pointer; display:flex; align-items:center; gap:10px; }
    .palette .item:hover { background: rgba(255,255,255,.04); }

    /* Small components */
    .row { display:flex; align-items:center; gap: 8px; }
    .grow { flex: 1; }
    .small { font-size: 12px; color: var(--muted); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .muted { color: var(--muted); }
    .flex { display:flex; }
    .gap8 { gap:8px; }
    .center { display:grid; place-items:center; }

    /* Dashboard */
    .hidden { display: none !important; }
    .dash-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }
    .progress { height: 8px; background: #0a0d15; border:1px solid var(--border); border-radius: 999px; overflow: hidden; }
    .progress > div { height: 100%; width: 62%; background: linear-gradient(90deg, var(--brand), var(--brand-2)); }

    /* Right panel */
    .right .stack { display:grid; gap: 10px; }
    .badge { padding:2px 8px; border-radius:999px; border:1px solid var(--border); font-size: 11px; color:var(--muted) }

    /* Editor content */
    textarea.editor-input { width: 100%; min-height: 280px; resize: vertical; background: #0c0f16; border:1px solid var(--border); color: var(--text); padding: 12px; border-radius: 12px; outline: none; }
    pre.code { margin:0; padding:12px; background:#0c0f16; border:1px solid var(--border); border-radius:12px; overflow:auto }

    /* Toast */
    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background:#0c0f16; border:1px solid var(--border); padding:10px 14px; border-radius:10px; display:none; box-shadow: var(--shadow); }

    @media (max-width: 1200px) {
      .app { grid-template-columns: 230px 1fr; }
      .right { display: none; }
    }
    @media (max-width: 860px) {
      .app { grid-template-columns: 1fr; grid-template-rows: 56px auto; }
      aside { display: none; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo" title="Spec‑Kit">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="2" y="3" width="20" height="14" rx="3" ry="3" stroke="url(#g)" stroke-width="1.8"/>
          <path d="M6 8h6" stroke="url(#g)" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M6 12h12" stroke="url(#g)" stroke-width="1.8" stroke-linecap="round"/>
          <rect x="8" y="19" width="8" height="3" rx="1.5" fill="url(#g)"/>
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="24" y2="24">
              <stop stop-color="#7c8cff"/>
              <stop offset="1" stop-color="#9b7cff"/>
            </linearGradient>
          </defs>
        </svg>
        <span>Spec‑Kit</span>
      </div>
      <button class="btn ghost" id="btnDashboard">Dashboard</button>
      <button class="btn ghost" id="btnEditor">Spec Editor</button>
      <button class="btn ghost" id="btnVerify">Verify</button>
      <div class="search">
        <input id="quickSearch" placeholder="Быстрый поиск ( / )" />
        <span class="kbd">Ctrl + K</span>
      </div>
      <button class="btn" id="btnSync">Sync with GitHub</button>
    </header>

    <!-- Sidebar -->
    <aside>
      <div class="section-title">
        <span>Спецификации</span>
        <button class="btn ghost" id="newSpec">＋</button>
      </div>
      <div class="list" id="specList"></div>

      <div class="section-title" style="margin-top:16px"><span>Фильтры</span></div>
      <div class="row gap8" style="flex-wrap:wrap">
        <span class="tag">Draft</span>
        <span class="tag">Planned</span>
        <span class="tag">In Progress</span>
        <span class="tag">Verified</span>
        <span class="tag">Released</span>
      </div>
    </aside>

    <!-- Main -->
    <main>
      <!-- DASHBOARD -->
      <section id="viewDashboard">
        <div class="dash-grid">
          <div class="card">
            <h4>Прогресс по релизу v1.3</h4>
            <div class="progress"><div style="width:62%"></div></div>
            <p class="small" style="margin-top:8px">7 / 11 спецификаций завершены</p>
          </div>
          <div class="card">
            <h4>Недавняя активность</h4>
            <ul class="small">
              <li>Spec <b>Booking Payments</b> обновлена · 5 мин назад</li>
              <li>Verify пройден: <b>Stripe Connect</b> · 1 ч назад</li>
              <li>Создана задача из Spec: <b>Inventory Batches</b></li>
            </ul>
          </div>
          <div class="card">
            <h4>Быстрые действия</h4>
            <div class="row gap8">
              <button class="btn" onclick="openPalette()">Открыть палитру</button>
              <button class="btn ghost" id="btnOneSpec">OneSpecShot</button>
            </div>
            <p class="small" style="margin-top:8px">AI: сгенерировать Plan/Tasks/Verify из текущей Feature.</p>
          </div>
        </div>
      </section>

      <!-- EDITOR -->
      <section id="viewEditor" class="hidden">
        <div class="split">
          <div>
            <div class="tabs">
              <div class="tab active" data-tab="feature">Feature</div>
              <div class="tab" data-tab="plan">Plan</div>
              <div class="tab" data-tab="tasks">Tasks</div>
              <div class="tab" data-tab="verify">Verify</div>
            </div>
            <div class="editor">
              <div class="toolbar">
                <span class="pill status"><span class="dot" id="statusDot"></span> <span id="statusText">Draft</span></span>
                <span class="pill">owner: <span id="owner" class="mono">denis</span></span>
                <span class="pill">repo: <span class="mono">stockbot</span></span>
                <div class="grow"></div>
                <button class="btn ghost" id="btnGenerate">AI Generate</button>
                <button class="btn" id="btnSave">Сохранить</button>
              </div>
              <textarea class="editor-input" id="editorInput"></textarea>
            </div>
          </div>
          <div class="card">
            <h4>Метаданные</h4>
            <div class="meta small">
              <div class="pill">tag: <span class="mono">payments</span></div>
              <div class="pill">branch: <span class="mono">feat/stripe-connect</span></div>
              <div class="pill">priority: <span class="mono">P1</span></div>
              <div class="pill">version: <span class="mono">1.3.0</span></div>
            </div>
            <h4 style="margin-top:12px">Линки</h4>
            <ul class="small" id="links">
              <li>PR: <span class="mono">#421</span> · check status: <span class="badge">pending</span></li>
              <li>Issues: <span class="mono">#713, #714</span></li>
              <li>Docs: <span class="mono">/docs/payments.md</span></li>
            </ul>
            <h4 style="margin-top:12px">AI‑советы</h4>
            <div class="small" id="aiTips">
              <ul>
                <li>Уточнить сценарий edge‑case: отмена платежа после 24 ч.</li>
                <li>Добавить negative‑тест на невалидный account id.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- VERIFY -->
      <section id="viewVerify" class="hidden">
        <div class="card">
          <h4>Verification Matrix</h4>
          <table class="small" style="width:100%; border-collapse: collapse;">
            <thead>
              <tr style="text-align:left">
                <th style="padding:8px; border-bottom:1px solid var(--border)">Spec</th>
                <th style="padding:8px; border-bottom:1px solid var(--border)">Task</th>
                <th style="padding:8px; border-bottom:1px solid var(--border)">Status</th>
                <th style="padding:8px; border-bottom:1px solid var(--border)">Last Check</th>
              </tr>
            </thead>
            <tbody id="verifyTable"></tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Right panel -->
    <div class="right">
      <div class="section-title"><span>GitHub Integration</span></div>
      <div class="stack">
        <div class="card">
          <h4>Linked PRs</h4>
          <div class="row small"><span class="badge">#421</span><span class="badge">open</span><span class="grow"></span><button class="btn ghost" onclick="toast('Обновлено из PR')">Pull changes</button></div>
        </div>
        <div class="card">
          <h4>Spec ↔ Code Diff</h4>
          <pre class="code small">- payments: success_url optional
+ payments: success_url required
          </pre>
          <div class="row" style="margin-top:8px"><button class="btn ghost" onclick="toast('Diff применён')">Apply</button><button class="btn ghost" onclick="toast('Diff отклонён')">Dismiss</button></div>
        </div>
        <div class="card">
          <h4>CI / Verify</h4>
          <div class="row small">
            <span class="badge">Run • verify.yml</span>
            <div class="grow"></div>
            <button class="btn" onclick="runVerify()">Run</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Command Palette -->
  <div class="overlay" id="overlay" onclick="closePalette(event)">
    <div class="palette" onclick="event.stopPropagation()">
      <input id="paletteInput" placeholder="Команды… (например, ‘generate tasks’)" />
      <div class="items" id="paletteItems"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Mock data
    const SPEC_DB = [
      { id: 'spec-1', title: 'Stripe Connect — Payouts to artists', status: 'Planned', owner: 'denis', tag: 'payments', content: `# Feature\nAs a platform, I want to pay artists via Stripe Connect Express...`, plan: `- use Checkout Session with account parameter\n- webhooks for payment_intent.succeeded`, tasks: `- create connect account\n- link account to user\n- payout schedule`, verify: `- create session for artist\n- ensure funds flow to connected account` },
      { id: 'spec-2', title: 'Inventory Batches & Expiry', status: 'In Progress', owner: 'denis', tag: 'inventory', content: `# Feature\nTrack batches and expiry dates for items...`, plan: `- add tables: batches, lots`, tasks: `- UI batch picker\n- Alerts before expiry`, verify: `- batch merge rules` },
      { id: 'spec-3', title: 'Bookings Calendar v2', status: 'Draft', owner: 'denis', tag: 'booking', content: `# Feature\nWeek view, drag-n-drop slots...`, plan: `- virtualized calendar`, tasks: `- slot resize`, verify: `- overlap prevention` },
    ];

    const VERIFY_ROWS = [
      { spec: 'Stripe Connect — Payouts to artists', task: 'Create session with account id', status: 'passed', at: 'сегодня, 12:04' },
      { spec: 'Inventory Batches & Expiry', task: 'Warn 7 days before expiry', status: 'failed', at: 'вчера, 18:22' },
      { spec: 'Bookings Calendar v2', task: 'Drag-n-drop updates server', status: 'pending', at: 'сегодня, 09:10' },
    ];

    const EL = {
      list: document.getElementById('specList'),
      editor: document.getElementById('editorInput'),
      statusDot: document.getElementById('statusDot'),
      statusText: document.getElementById('statusText'),
      verifyTable: document.getElementById('verifyTable'),
    };

    let state = { view: 'dashboard', activeSpecId: 'spec-1', activeTab: 'feature' };

    function renderList() {
      EL.list.innerHTML = SPEC_DB.map(s => `
        <div class="spec-item" data-id="${s.id}" onclick="openSpec('${s.id}')">
          <div class="row">
            <b class="grow">${s.title}</b>
            <span class="tag">${s.status}</span>
          </div>
          <div class="row small">
            <span class="badge">${s.tag}</span>
            <span class="badge mono">owner:${s.owner}</span>
          </div>
        </div>`).join('');
    }

    function openSpec(id) {
      state.activeSpecId = id; switchView('editor');
      const s = SPEC_DB.find(x => x.id === id);
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.tab[data-tab="'+state.activeTab+'"]').classList.add('active');
      loadTab(state.activeTab);
      EL.statusText.textContent = s.status;
      EL.statusDot.style.background = s.status === 'Verified' ? 'var(--success)' : s.status === 'In Progress' ? 'var(--brand)' : s.status === 'Planned' ? 'var(--warn)' : '#8892a6';
    }

    function loadTab(tab) {
      const s = SPEC_DB.find(x => x.id === state.activeSpecId);
      state.activeTab = tab;
      const map = { feature: 'content', plan: 'plan', tasks: 'tasks', verify: 'verify' };
      EL.editor.value = s[map[tab]] || '';
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab===tab));
    }

    function saveCurrent() {
      const s = SPEC_DB.find(x => x.id === state.activeSpecId);
      const key = { feature: 'content', plan: 'plan', tasks: 'tasks', verify: 'verify' }[state.activeTab];
      s[key] = EL.editor.value;
      toast('Сохранено ✓');
    }

    function generateAI() {
      const s = SPEC_DB.find(x => x.id === state.activeSpecId);
      if (state.activeTab === 'plan') EL.editor.value = `- derive plan from feature\n- add acceptance criteria\n- define owners & risks`;
      if (state.activeTab === 'tasks') EL.editor.value = `- create issues in GitHub\n- link PR template\n- add labels P1`;
      if (state.activeTab === 'verify') EL.editor.value = `- run CI verify.yml\n- contract tests for API\n- edge cases & rollbacks`;
      if (state.activeTab === 'feature') EL.editor.value = (s.content + `\n\n## Non‑functional\n- security: oauth scopes\n- perf: p95 < 250ms`);
      toast('AI сгенерировал черновик');
    }

    function switchView(view) {
      state.view = view;
      document.getElementById('viewDashboard').classList.toggle('hidden', view!== 'dashboard');
      document.getElementById('viewEditor').classList.toggle('hidden', view!== 'editor');
      document.getElementById('viewVerify').classList.toggle('hidden', view!== 'verify');
    }

    function renderVerify() {
      EL.verifyTable.innerHTML = VERIFY_ROWS.map(r => `<tr>
        <td style="padding:8px; border-bottom:1px solid var(--border)">${r.spec}</td>
        <td style="padding:8px; border-bottom:1px solid var(--border)">${r.task}</td>
        <td style="padding:8px; border-bottom:1px solid var(--border)"><span class="badge" style="border-color:transparent; background:${r.status==='passed'?'#1b3a28':r.status==='failed'?'#3a1b1b':'#1b2e3a'}">${r.status}</span></td>
        <td style="padding:8px; border-bottom:1px solid var(--border)">${r.at}</td>
      </tr>`).join('');
    }

    function openPalette() {
      document.getElementById('overlay').style.display = 'flex';
      const items = [
        { k: 'new spec', label: 'New spec', run: () => createSpec() },
        { k: 'sync', label: 'Sync with GitHub', run: () => toast('Синхронизировано ✓') },
        { k: 'generate tasks', label: 'Generate Tasks from Plan', run: () => { state.activeTab='tasks'; loadTab('tasks'); generateAI(); } },
        { k: 'verify all', label: 'Run Verify for all', run: () => runVerify() },
        { k: 'switch dashboard', label: 'Switch to Dashboard', run: () => switchView('dashboard') },
        { k: 'switch editor', label: 'Switch to Editor', run: () => switchView('editor') },
      ];
      const list = document.getElementById('paletteItems');
      const input = document.getElementById('paletteInput');
      function draw(filter=''){
        const q = filter.toLowerCase();
        list.innerHTML = items.filter(i => i.k.includes(q)).map((i, idx) => `<div class="item" data-idx="${idx}">▶ ${i.label}</div>`).join('');
      }
      draw();
      list.onclick = (e)=>{
        const el = e.target.closest('.item'); if(!el) return; const idx = +el.dataset.idx; items[idx].run(); closePalette();
      };
      input.oninput = (e)=> draw(e.target.value);
      input.onkeydown = (e)=>{ if(e.key==='Escape'){ closePalette(); } if(e.key==='Enter'){ const top = list.querySelector('.item'); if(top){ top.click(); } } };
      input.focus();
    }
    function closePalette(e){ document.getElementById('overlay').style.display='none'; }

    function createSpec(){
      const id = 'spec-' + (SPEC_DB.length+1);
      SPEC_DB.unshift({ id, title: 'New Spec', status: 'Draft', owner: 'denis', tag: 'general', content: '# Feature\nDescribe...', plan: '', tasks: '', verify: '' });
      renderList(); openSpec(id); toast('Создан черновик спецификации');
    }

    function toast(msg){ const t = document.getElementById('toast'); t.textContent = msg; t.style.display='block'; setTimeout(()=> t.style.display='none', 1400); }

    function runVerify(){ toast('Verify запущен…'); setTimeout(()=>{ VERIFY_ROWS[1].status='passed'; renderVerify(); toast('Verify завершён ✓'); }, 900); }

    // Events
    document.getElementById('btnDashboard').onclick = () => switchView('dashboard');
    document.getElementById('btnEditor').onclick = () => switchView('editor');
    document.getElementById('btnVerify').onclick = () => { renderVerify(); switchView('verify'); };
    document.getElementById('btnSave').onclick = saveCurrent;
    document.getElementById('btnGenerate').onclick = generateAI;
    document.getElementById('newSpec').onclick = createSpec;
    document.getElementById('btnSync').onclick = ()=> toast('Синхронизировано с GitHub');
    document.getElementById('btnOneSpec').onclick = ()=> { openSpec(state.activeSpecId); ['plan','tasks','verify'].forEach(t=>{ state.activeTab=t; generateAI(); }); state.activeTab='feature'; toast('OneSpecShot выполнен'); };

    // Keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){ e.preventDefault(); document.getElementById('quickSearch').focus(); }
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k'){ e.preventDefault(); openPalette(); }
      if(e.key === 'Escape'){ closePalette(); }
    });

    // Init
    renderList(); openSpec('spec-1'); renderVerify();
  </script>
</body>
</html>
